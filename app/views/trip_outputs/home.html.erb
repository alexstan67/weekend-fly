<% require "normalize_country" %>

<div class="to-container p-5">
  <div class="to-container-flight-info m-20">
    <div class="to-container-flight-summary p-20">
      <h1><em>Flight</em> Summary</h1>
    
      <h3>Departure Airport</h2>
      <%= "#{Airport.find_by(icao: @trip_input.dep_airport_icao).name} ( #{@trip_input.dep_airport_icao} | #{Airport.find_by(icao: @trip_input.dep_airport_icao).local_code} ) #{NormalizeCountry(Airport.find_by(icao: @trip_input.dep_airport_icao).country, :to => :emoji)}"  %>

      <h3>Distance & E.E.T.</h2>
      <%= "#{@trip_input.distance_nm}nm (with 10% margin) | #{pluralize(@trip_input.eet_hour, "hour")} flight" %>

      <h3>Return Flight</h3>
      <% if @trip_input.overnights > 0 %>
        <%= "#{@return_day} (#{pluralize(@trip_input.overnights, "overnight")})" %>
      <% else %>
        <%= "#{@return_day}" %>
      <% end %>
      
      <h3>Filters</h3>
      <% if @trip_input.small_airport %>
          <span class="tag tag-info">small airport</span>
      <% end %>
      <% if @trip_input.medium_airport %>
          <span class="tag tag-info">medium airport</span>
      <% end %>
      <% if @trip_input.large_airport %>
        <span class="tag tag-info">large airport</span>
      <% end %>
      <% if @trip_input.international_flight %>
        <span class="tag tag-info">international</span>
      <% else %>
        <span class="tag tag-info">national</span>
      <% end %>

      <h3>Departure Weather UTC</h3>
      <table>
        <tr>
          <% @fly_out_dep_hour.each do |h| %> 
            <th><%= h %>h</th>
          <% end %>
        </tr>
        <tr>
          <% @fly_out_dep_hour.each_with_index do |h, index| %> 
            <td><img src="http://openweathermap.org/img/wn/<%= @fly_out_dep_icon[ index ] %>.png" alt="weather logo" title="<%= @fly_out_dep_descr[ index ] %>"></td>
          <% end %>
        </tr>
      </table>

      <div class="mt-20">
        <%= link_to "Edit", edit_trip_input_path(@trip_input), class:"btn btn-secondary" %>
      </div>

    </div>
    <div class="to-container-map">
      coming map
    </div>
  </div>
  <div class="to-container-airport-selection m-20 p-20">
    <% @filtered_airports.each do |airport| %>
      <div class="to-as-flight p-10 mb-10">
        <div class="to-as-flight-element">
          <div><%= image_tag("eye.svg") %></div>
        </div>
        <div class="to-as-flight-element to-outline">
          <div class="distance"><%= "Distance #{airport.distance.round(1)} #{current_user.distance_unit}" %></div>
          <div class="tag tag-outline-light m-5"><%= airport.airport_type %></div>
          <div><%= "#{NormalizeCountry(Airport.find_by(icao: airport.icao).country, :to => :emoji)} #{airport.name} ( #{airport.icao } | #{Airport.find_by(icao: airport.icao).local_code} )"%></div>
        </div>
      </div>
    <% end %>
  </div>
</div>
